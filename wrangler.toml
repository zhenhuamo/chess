# Cloudflare Pages / Workers runtime config for Next on Pages output
# This enables Node.js built-ins (node:buffer, node:async_hooks, etc.) used by the
# generated _worker.js. Pages will detect this file and apply flags at runtime.

name = "chess-pages"
account_id = "e833787aba82fc4986e1458b298231e0"
compatibility_date = "2025-10-27"
compatibility_flags = ["nodejs_compat"]

# Tell Cloudflare Pages which directory to publish from the framework build.
# This makes Pages honor the compatibility flags in this file.
# 对于 Next 静态导出使用 out 目录；如果切回 Next on Pages，再改回 .vercel/output/static
pages_build_output_dir = "out"

[vars]
# Minimal env: serve engines from same-origin proxy and force remote assets
NEXT_PUBLIC_ENGINE_BASE_URL = "/engines/"
NEXT_PUBLIC_ENGINE_REMOTE_ONLY = "1"
EXPL_MANIFEST_URL = "https://cacle.chess-analysis.org/games/games-manifest.json"

[[r2_buckets]]
binding = "SHARE"
bucket_name = "chess-share"

[[d1_databases]]
binding = "PUZZLE_DB"          # 你在应用里用的名字，随意；比如 PUZZLE_DB
database_name = "lichess-puzzles"
database_id = "7429df01-34df-415e-a376-7960a3088e03"
remote = true        # 关键：告诉 wrangler 在 dev 时使用远程 D1
